<!DOCTYPE HTML>

<html lang="es">
<head>
    <!-- Datos que describen el documento -->
    <meta name ="author" content ="Luis Sánchez de Posada Orihuela, UO277488" />
    <meta name ="description" content ="documento a utilizar en otros módulos de la asignatura a fecha de creación del proyecto" />
    <meta name ="keywords" content ="aquí cada documento debe tener la lista
de las palabras clave del mismo separadas por comas" />
    <meta name ="viewport" content ="width=device-width, initial-scale=1.0" />
    <meta charset="UTF-8" />
    <link rel="icon" href="multimedia/favicon.ico" type="image/x-icon">
    <link rel="stylesheet" href="estilo/estilo.css">
    <link rel="stylesheet" href="estilo/layout.css">
    <title>MotoGP-Meteorología</title>
    <!-- Añadimos jQuery para las llamadas AJAX de meteorología -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="js/ciudad.js"></script>
</head>

<body>
    <header>
        <!-- Datos con el contenidos que aparece en el navegador -->
        <h1>
            <a href="index.html" title="Ir a la página principal">MotoGP Desktop</a>
        </h1>
        <nav>
            <a href="index.html" title="Página principal">Inicio</a>
            <a href="piloto.html" title="Información del piloto">Piloto</a>
            <a href="circuito.html" title="Información del circuito">Circuito</a>
            <a href="meteorología.html" class ="active" title="Información de la meteorología">Meteorología</a>
            <a href="clasificaciones.php" title="Información sobre las clasificaciones">Clasificaciones</a>
            <a href="juegos.html" title="Información a cerca de los juegos">Juegos</a>
            <a href="ayuda.html" title="Accede a la ayuda">Ayuda</a>
        </nav>
    </header>
    
    <main>
        <p>Estás en: <a href="index.html">Inicio</a> &gt;&gt; <strong>Meteorología</strong></p>
        <h2>Meteorología del circuito</h2>
        <p>Consulta predicciones y datos históricos para la fecha de la carrera. Introduce la fecha de la carrera o la fecha final de los entrenamientos y pulsa los controles para obtener la meteorología (Open‑Meteo).</p>
        <script>
            var ciudad = new Ciudad('Austin', 'Estados Unidos', 'austinés');
            ciudad.rellenarAtributos(993588, '30°18′00″N 97°44′00″O');


            const main = document.querySelector('main');
            const pDescripcion = document.createElement('p');
            pDescripcion.textContent = ciudad.obtenerDescripcion();
            main.appendChild(pDescripcion);

            

            // mostrar coordenadas (método que escribe directamente en el documento o añade un párrafo)
            // si el método usar document.write() podría sobrescribir el documento si se ejecuta fuera del parsing;
            // en la versión actual de ciudad.js mostrarCoordenadas() crea y añade un <p>, por eso la llamamos.
            ciudad.mostrarCoordenadas();

            main.insertAdjacentHTML('beforeend', ciudad.obtenerGentilicioPoblacion());

            /* Controles y zonas de resultado para las tareas de meteorología */
            main.insertAdjacentHTML('beforeend', `
              <section aria-label="Controles meteorología" data-meteorologia-controles>
                <h3>Consultar meteorología (Open‑Meteo)</h3>
                <p>Introduce la <strong>fecha de la carrera</strong> (YYYY‑MM‑DD) y pulsa "Obtener meteorología" para ver la predicción/histórico del día de la carrera.</p>
                <label>Fecha de la carrera: <input data-fecha-carrera type="date" aria-label="Fecha de la carrera"></label>
                <button data-obtener-carrera type="button">Obtener meteorología de la carrera</button>

                <hr>
                <p>O bien consulta los <strong>3 días de entrenamientos</strong> indicando la fecha final (día anterior a la carrera) y pulsa "Obtener entrenamientos".</p>
                <label>Último día de entrenamientos: <input data-fecha-entrenos type="date" aria-label="Último día de entrenamientos"></label>
                <button data-obtener-entrenos type="button">Obtener meteorología entrenos (3 días)</button>
              </section>

              <section aria-label="Meteorología de la carrera" data-meteorologia-carrera></section>
              <section aria-label="Meteorología de entrenamientos" data-meteorologia-entrenos></section>
            `);

            // Añadimos handlers para botones que llamarán a los métodos de la clase Ciudad
            document.querySelector('[data-obtener-carrera]').addEventListener('click', function(){
              const fecha = document.querySelector('[data-fecha-carrera]').value;
              if (!fecha) {
                console.warn('Por favor introduce la fecha de la carrera en formato YYYY-MM-DD');
                document.querySelector('[data-fecha-carrera]').focus();
                return;
              }
              ciudad.getMeteorologiaCarrera(fecha);
            });

            document.querySelector('[data-obtener-entrenos]').addEventListener('click', function(){
              const fechaFinal = document.querySelector('[data-fecha-entrenos]').value;
              if (!fechaFinal) {
                console.warn('Por favor introduce la fecha final de los entrenamientos (último día)');
                document.querySelector('[data-fecha-entrenos]').focus();
                return;
              }
              ciudad.getMeteorologiaEntrenos(fechaFinal);
            });
        </script>
    </main>
</body>
